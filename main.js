const translations = {
  en: {
    lottoTitle: "Lotto Number Generator",
    animalTitle: "Animal Face Test",
    generateBtn: "Generate Numbers",
    toggleDark: "Toggle Dark Mode",
    toggleLight: "Toggle Light Mode",
    animalDesc: "Find out which animal you look like!",
    startCamera: "Start Real-time Camera",
    uploadBtn: "Upload Image File",
    lottoSub: "Try switching between Light and Dark mode using the button below.",
    partnershipTitle: "Partnership Inquiry",
    sendInquiry: "Send Inquiry",
    placeholderName: "Name",
    placeholderEmail: "Email",
    placeholderMsg: "Message",
    backLotto: "← Lotto Generator",
    goAnimal: "Animal Face Test →",
    aboutLottoTitle: "About This Lotto Generator",
    aboutLottoDesc: "Our random number generator is designed to create a set of unique numbers for lottery games. It uses a secure randomization algorithm to ensure fairness and unpredictability.",
    whyLottoTitle: "Why Use a Random Generator?",
    whyLotto1: "Remove Bias: Avoid picking numbers based on personal significance.",
    whyLotto2: "Quick Selection: Generate a full set of numbers instantly.",
    whyLotto3: "Statistical Fairness: Each number has an equal probability.",
    aboutAnimalTitle: "About Animal Face Test",
    aboutAnimalDesc: "Ever wondered which animal you resemble the most? Our AI-powered Animal Face Test uses advanced image recognition technology to analyze your facial features.",
    howItWorksTitle: "How It Works",
    howItWorksDesc: "We use a pre-trained machine learning model that scans key facial landmarks and compares them to its database of animal faces.",
    privacyTitle: "Is My Data Safe?",
    privacyDesc: "Yes! All image processing happens directly in your browser. Your photos are never sent to our servers.",
    footerCopy: "© 2026 Lotto & Animal Test. All rights reserved.",
    privacyPolicy: "Privacy Policy",
    termsOfService: "Terms of Service",
    langEn: "English",
    langKo: "한국어",
    privacyContent: `
        <h2>1. Introduction</h2>
        <p>Welcome to our website. We respect your privacy and are committed to protecting it.</p>
        <h2>2. Information We Collect</h2>
        <p>We do not collect personal identification information unless you voluntarily provide it.</p>
        <h2>3. Cookies</h2>
        <p>We use cookies to store information about visitors' preferences.</p>
        <h2>4. Google AdSense</h2>
        <p>Google uses cookies to serve ads on our site.</p>
    `,
    termsContent: `
        <h2>1. Acceptance of Terms</h2>
        <p>By using this website, you agree to these terms.</p>
        <h2>2. Disclaimer</h2>
        <p>Content is for entertainment purposes only.</p>
        <h2>3. Limitation of Liability</h2>
        <p>We are not liable for any damages arising from use.</p>
    `
  },
  ko: {
    lottoTitle: "로또 번호 생성기",
    animalTitle: "동물상 테스트",
    generateBtn: "번호 생성하기",
    toggleDark: "다크 모드",
    toggleLight: "라이트 모드",
    animalDesc: "당신은 어떤 동물을 닮았나요?",
    startCamera: "실시간 카메라 시작",
    uploadBtn: "이미지 파일 업로드",
    lottoSub: "아래 버튼을 눌러 번호를 생성하고 테마를 변경해보세요.",
    partnershipTitle: "제휴 문의",
    sendInquiry: "문의 보내기",
    placeholderName: "이름",
    placeholderEmail: "이메일",
    placeholderMsg: "내용",
    backLotto: "← 로또 생성기",
    goAnimal: "동물상 테스트 →",
    aboutLottoTitle: "로또 번호 생성기 소개",
    aboutLottoDesc: "이 무작위 번호 생성기는 로또 게임을 위해 고유한 번호 세트를 생성하도록 설계되었습니다. 보안성이 높은 알고리즘을 사용하여 공정성과 예측 불가능성을 보장합니다.",
    whyLottoTitle: "왜 무작위 생성기를 사용하나요?",
    whyLotto1: "편향 제거: 생일이나 특정 수열 같은 개인적인 패턴을 피할 수 있습니다.",
    whyLotto2: "빠른 선택: 고민 없이 즉석에서 번호 세트를 생성합니다.",
    whyLotto3: "통계적 공정성: 모든 번호는 선택될 확률이 동일합니다.",
    aboutAnimalTitle: "동물상 테스트 소개",
    aboutAnimalDesc: "당신이 어떤 동물을 가장 많이 닮았는지 궁금한 적이 있나요? AI 기반 동물상 테스트는 고급 이미지 인식 기술을 사용하여 얼굴 특징을 분석합니다.",
    howItWorksTitle: "작동 원리",
    howItWorksDesc: "이미지 패턴을 학습한 인공지능 모델을 사용하여 얼굴의 주요 특징을 스캔하고 데이터베이스와 비교합니다.",
    privacyTitle: "내 데이터는 안전한가요?",
    privacyDesc: "네! 모든 이미지 처리는 브라우저에서 직접 이루어집니다. 사진이나 비디오 스트림은 서버로 전송되지 않습니다.",
    footerCopy: "© 2026 Lotto & Animal Test. 모든 권리 보유.",
    privacyPolicy: "개인정보처리방침",
    termsOfService: "이용약관",
    langEn: "English",
    langKo: "한국어",
    privacyContent: `
        <h2>1. 서론</h2>
        <p>저희 웹사이트 방문을 환영합니다. 귀하의 개인정보를 존중하며 이를 보호하기 위해 최선을 다하고 있습니다.</p>
        <h2>2. 수집하는 정보</h2>
        <p>귀하가 자발적으로 제공하지 않는 한 개인 식별 정보를 수집하지 않습니다.</p>
        <h2>3. 쿠키</h2>
        <p>방문자의 선호도를 저장하기 위해 쿠키를 사용합니다.</p>
        <h2>4. 구글 애드센스</h2>
        <p>구글은 제3자 제공업체로서 쿠키를 사용하여 사이트에 광고를 게재합니다.</p>
    `,
    termsContent: `
        <h2>1. 약관 동의</h2>
        <p>이 웹사이트를 이용함으로써 귀하는 본 약관에 동의하게 됩니다.</p>
        <h2>2. 면책 조항</h2>
        <p>모든 콘텐츠는 오락 목적으로만 제공됩니다.</p>
        <h2>3. 책임의 한계</h2>
        <p>사용으로 인해 발생하는 어떠한 손해에 대해서도 책임을 지지 않습니다.</p>
    `
  }
};

function applyLanguage(lang) {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (translations[lang][key]) {
      if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
        el.placeholder = translations[lang][key];
      } else if (key.endsWith('Content')) {
        el.innerHTML = translations[lang][key];
      } else {
        el.textContent = translations[lang][key];
      }
    }
  });
  document.documentElement.lang = lang;
}

document.addEventListener('DOMContentLoaded', () => {
  const themeToggle = document.getElementById('theme-toggle');
  const generateBtn = document.getElementById('generate-btn');
  const lottoContainer = document.getElementById('lotto-container');
  const balls = document.querySelectorAll('.ball');
  const body = document.body;
  const langSelect = document.getElementById('lang-select');

  // Theme preference persistence
  const currentTheme = localStorage.getItem('theme');
  if (currentTheme === 'dark') {
    body.classList.add('dark-mode');
    if (themeToggle) themeToggle.textContent = translations[localStorage.getItem('lang') || 'ko'].toggleLight;
  }

  if (themeToggle) {
    themeToggle.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      let theme = body.classList.contains('dark-mode') ? 'dark' : 'light';
      const lang = localStorage.getItem('lang') || 'ko';
      themeToggle.textContent = theme === 'dark' ? translations[lang].toggleLight : translations[lang].toggleDark;
      localStorage.setItem('theme', theme);
    });
  }

  // Language persistence
  const savedLang = localStorage.getItem('lang') || (navigator.language.startsWith('ko') ? 'ko' : 'en');
  if (langSelect) langSelect.value = savedLang;
  applyLanguage(savedLang);
  localStorage.setItem('lang', savedLang);

  if (langSelect) {
    langSelect.addEventListener('change', (e) => {
      const newLang = e.target.value;
      localStorage.setItem('lang', newLang);
      applyLanguage(newLang);
      // Update theme toggle text if it exists
      if (themeToggle) {
        const isDark = body.classList.contains('dark-mode');
        themeToggle.textContent = isDark ? translations[newLang].toggleLight : translations[newLang].toggleDark;
      }
    });
  }

  // Lotto number generation logic
  if (generateBtn) {
    generateBtn.addEventListener('click', () => {
      const numbers = new Set();
      while (numbers.size < 6) {
        numbers.add(Math.floor(Math.random() * 45) + 1);
      }
      const sortedNumbers = Array.from(numbers).sort((a, b) => a - b);

      balls.forEach((ball, index) => {
        setTimeout(() => {
          ball.textContent = sortedNumbers[index];
          ball.classList.remove('animate');
          void ball.offsetWidth;
          ball.classList.add('animate');
        }, index * 100);
      });
    });
  }
});
